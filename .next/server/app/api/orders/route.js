"use strict";(()=>{var r={};r.id=146,r.ids=[146],r.modules={517:r=>{r.exports=require("next/dist/compiled/next-server/app-route.runtime.prod.js")},4300:r=>{r.exports=require("buffer")},6113:r=>{r.exports=require("crypto")},2361:r=>{r.exports=require("events")},3685:r=>{r.exports=require("http")},5687:r=>{r.exports=require("https")},1808:r=>{r.exports=require("net")},4577:r=>{r.exports=require("punycode")},2781:r=>{r.exports=require("stream")},4404:r=>{r.exports=require("tls")},7310:r=>{r.exports=require("url")},9796:r=>{r.exports=require("zlib")},6859:(r,e,o)=>{o.r(e),o.d(e,{headerHooks:()=>x,originalPathname:()=>q,patchFetch:()=>v,requestAsyncStorage:()=>l,routeModule:()=>c,serverHooks:()=>h,staticGenerationAsyncStorage:()=>m,staticGenerationBailout:()=>f});var t={};o.r(t),o.d(t,{GET:()=>p,POST:()=>u});var s=o(884),a=o(6132),i=o(1040),n=o(5798),d=o(1762);async function u(r){try{let{customerName:e,customerPhone:o,deliveryAddress:t,paymentMethod:s,observations:a,items:i,total:u}=await r.json();if(!e||!o||!i||!Array.isArray(i)||0===i.length)return n.Z.json({error:"Dados incompletos para o pedido"},{status:400});let p=crypto.randomUUID(),{error:c}=await d.OQ.from("orders").insert({id:p,customer_name:e,customer_phone:o,delivery_address:t||"",payment_method:s||"dinheiro",observations:a||"",total:u,status:"pendente"});if(c)return console.error("Erro ao criar pedido:",c),n.Z.json({error:"Erro ao criar o pedido"},{status:500});let l=i.map(r=>{let e=r.variation_name||null,o=r.extras_info||null;r.variation&&!e&&(e=r.variation.name),r.extras&&r.extras.length>0&&!o&&(o=r.extras.map(r=>r.name).join(", "));let t=r.product_id||r.id;return{id:crypto.randomUUID(),order_id:p,product_id:t,product_name:r.name,quantity:r.quantity,unit_price:r.price,variation_name:e,extras_info:o}}),{error:m}=await d.OQ.from("order_items").insert(l);if(m)return console.error("Erro ao inserir itens do pedido:",m),await d.OQ.from("orders").delete().eq("id",p),n.Z.json({error:"Erro ao processar itens do pedido"},{status:500});return n.Z.json({success:!0,orderId:p,message:"Pedido criado com sucesso"},{status:201})}catch(r){return console.error("Erro ao processar pedido:",r),n.Z.json({error:"Erro interno do servidor"},{status:500})}}async function p(){try{let{data:r,error:e}=await d.OQ.from("orders").select("*").order("created_at",{ascending:!1});if(e)return console.error("Erro ao buscar pedidos:",e),n.Z.json({error:"Erro ao buscar pedidos"},{status:500});return n.Z.json(r)}catch(r){return console.error("Erro ao processar requisi\xe7\xe3o:",r),n.Z.json({error:"Erro interno do servidor"},{status:500})}}let c=new s.AppRouteRouteModule({definition:{kind:a.x.APP_ROUTE,page:"/api/orders/route",pathname:"/api/orders",filename:"route",bundlePath:"app/api/orders/route"},resolvedPagePath:"/projetos/cardapio/src/app/api/orders/route.ts",nextConfigOutput:"",userland:t}),{requestAsyncStorage:l,staticGenerationAsyncStorage:m,serverHooks:h,headerHooks:x,staticGenerationBailout:f}=c,q="/api/orders/route";function v(){return(0,i.patchFetch)({serverHooks:h,staticGenerationAsyncStorage:m})}},1762:(r,e,o)=>{o.d(e,{OQ:()=>s});var t=o(3963);let s=(0,t.eI)("https://tcbketwbrlawpbktasva.supabase.co","eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6InRjYmtldHdicmxhd3Bia3Rhc3ZhIiwicm9sZSI6ImFub24iLCJpYXQiOjE3NDc1ODMzOTUsImV4cCI6MjA2MzE1OTM5NX0.ZSsKVOAlZj9GdYkS0a5kD7w1qE63ag86KfXVo3hnXzA",{auth:{persistSession:!0,autoRefreshToken:!0},global:{headers:{}}})}};var e=require("../../../webpack-runtime.js");e.C(r);var o=r=>e(e.s=r),t=e.X(0,[271,297],()=>o(6859));module.exports=t})();