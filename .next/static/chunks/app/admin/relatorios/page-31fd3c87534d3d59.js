(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[394],{9991:function(e,t,a){Promise.resolve().then(a.bind(a,7653))},7653:function(e,t,a){"use strict";a.r(t),a.d(t,{default:function(){return i}});var l=a(7437),r=a(2265),s=a(7823),n=a(345);function i(){let[e,t]=(0,r.useState)(!0),[a,i]=(0,r.useState)({dateRange:{startDate:new Date(Date.now()-2592e6).toISOString().split("T")[0],endDate:new Date().toISOString().split("T")[0]},status:["pendente","confirmado","em_preparo","a_caminho","entregue","cancelado"],paymentMethod:"all",category:"all"}),[u,m]=(0,r.useState)({totalOrders:0,totalRevenue:0,avgOrderValue:0,pendingOrders:0,completedOrders:0,canceledOrders:0,ordersByPaymentMethod:{pix:0,cartao:0,dinheiro:0}}),[g,h]=(0,r.useState)([]),[x,p]=(0,r.useState)([]);(0,r.useEffect)(()=>{b(),j()},[]),(0,r.useEffect)(()=>{j()},[a]);let b=async()=>{try{let{data:e,error:t}=await s.OQ.from("categories").select("id, name").order("name");if(t)throw t;p(e||[])}catch(e){console.error("Erro ao buscar categorias:",e)}},j=async()=>{t(!0);try{await y(),await v()}catch(e){console.error("Erro ao buscar dados de relat\xf3rios:",e)}finally{t(!1)}},y=async()=>{let e=s.OQ.from("orders").select("*",{count:"exact"}).gte("created_at","".concat(a.dateRange.startDate,"T00:00:00")).lte("created_at","".concat(a.dateRange.endDate,"T23:59:59"));a.status.length<6&&(e=e.in("status",a.status)),"all"!==a.paymentMethod&&(e=e.eq("payment_method",a.paymentMethod));let{data:t,error:l,count:r}=await e;if(l)throw l;let n=(null==t?void 0:t.reduce((e,t)=>{let a="string"==typeof t.total?parseFloat(t.total):t.total||0;return e+a},0))||0,i=r&&r>0?n/r:0,d=(null==t?void 0:t.filter(e=>["pendente","confirmado","em_preparo","a_caminho"].includes(e.status)).length)||0,o=(null==t?void 0:t.filter(e=>"entregue"===e.status).length)||0,c=(null==t?void 0:t.filter(e=>"cancelado"===e.status).length)||0,u={pix:(null==t?void 0:t.filter(e=>"pix"===e.payment_method).length)||0,cartao:(null==t?void 0:t.filter(e=>"cartao"===e.payment_method).length)||0,dinheiro:(null==t?void 0:t.filter(e=>"dinheiro"===e.payment_method).length)||0};m({totalOrders:r||0,totalRevenue:n,avgOrderValue:i,pendingOrders:d,completedOrders:o,canceledOrders:c,ordersByPaymentMethod:u})},v=async()=>{let e=s.OQ.from("orders").select("id").gte("created_at","".concat(a.dateRange.startDate,"T00:00:00")).lte("created_at","".concat(a.dateRange.endDate,"T23:59:59"));a.status.length<6&&(e=e.in("status",a.status)),"all"!==a.paymentMethod&&(e=e.eq("payment_method",a.paymentMethod));let{data:t,error:l}=await e;if(l)throw l;if(!t||0===t.length){h([]);return}let r=s.OQ.from("order_items").select("\n        id,\n        quantity,\n        unit_price,\n        order_id,\n        products (id, name)\n      ").in("order_id",t.map(e=>e.id)),{data:n,error:i}=await r;if(i)throw i;if(!n||0===n.length){h([]);return}let d=n;if("all"!==a.category){let{data:e,error:t}=await s.OQ.from("products").select("id").eq("category_id",a.category);if(!t&&e&&e.length>0){let t=e.map(e=>e.id);d=n.filter(e=>t.includes(e.products.id))}}let o={};d.forEach(e=>{let t=e.products.id,a=e.products.name,l=e.quantity||0,r="string"==typeof e.unit_price?parseFloat(e.unit_price):e.unit_price||0,s=l*r;o[t]?(o[t].quantity+=l,o[t].totalRevenue+=s):o[t]={productId:t,productName:a,quantity:l,totalRevenue:s}});let c=Object.values(o).sort((e,t)=>t.totalRevenue-e.totalRevenue).slice(0,10);h(c)},f=e=>{let t=new Date(e);return t.toLocaleDateString("pt-BR")},N=e=>{a.status.includes(e)?a.status.length>1&&i({...a,status:a.status.filter(t=>t!==e)}):i({...a,status:[...a.status,e]})},w=(e,t)=>{i({...a,dateRange:{...a.dateRange,[e]:t}})},D=(e,t)=>{i({...a,[e]:t})},O=e=>{let t=u.totalOrders;if(0===t)return 0;let a=u.ordersByPaymentMethod[e]||0;return Math.round(a/t*100)};return(0,l.jsxs)("div",{className:"p-6",children:[(0,l.jsx)("h1",{className:"text-2xl font-bold mb-6",children:"Relat\xf3rios"}),(0,l.jsxs)("div",{className:"bg-white rounded-xl shadow-sm p-6 mb-6",children:[(0,l.jsx)("h2",{className:"text-lg font-medium mb-4",children:"Filtros"}),(0,l.jsxs)("div",{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 gap-4",children:[(0,l.jsxs)("div",{children:[(0,l.jsx)("label",{className:"block text-sm text-gray-600 mb-1",children:"Data inicial"}),(0,l.jsx)("input",{type:"date",value:a.dateRange.startDate,onChange:e=>w("startDate",e.target.value),className:"w-full rounded-lg border border-gray-300 px-3 py-2 text-sm"})]}),(0,l.jsxs)("div",{children:[(0,l.jsx)("label",{className:"block text-sm text-gray-600 mb-1",children:"Data final"}),(0,l.jsx)("input",{type:"date",value:a.dateRange.endDate,onChange:e=>w("endDate",e.target.value),className:"w-full rounded-lg border border-gray-300 px-3 py-2 text-sm"})]}),(0,l.jsxs)("div",{children:[(0,l.jsx)("label",{className:"block text-sm text-gray-600 mb-1",children:"M\xe9todo de pagamento"}),(0,l.jsxs)("select",{value:a.paymentMethod,onChange:e=>D("paymentMethod",e.target.value),className:"w-full rounded-lg border border-gray-300 px-3 py-2 text-sm",children:[(0,l.jsx)("option",{value:"all",children:"Todos"}),(0,l.jsx)("option",{value:"dinheiro",children:"Dinheiro"}),(0,l.jsx)("option",{value:"cartao",children:"Cart\xe3o"}),(0,l.jsx)("option",{value:"pix",children:"PIX"})]})]}),(0,l.jsxs)("div",{children:[(0,l.jsx)("label",{className:"block text-sm text-gray-600 mb-1",children:"Categoria"}),(0,l.jsxs)("select",{value:a.category,onChange:e=>D("category",e.target.value),className:"w-full rounded-lg border border-gray-300 px-3 py-2 text-sm",children:[(0,l.jsx)("option",{value:"all",children:"Todas"}),x.map(e=>(0,l.jsx)("option",{value:e.id,children:e.name},e.id))]})]})]}),(0,l.jsxs)("div",{className:"mt-4",children:[(0,l.jsx)("label",{className:"block text-sm text-gray-600 mb-2",children:"Status dos pedidos"}),(0,l.jsxs)("div",{className:"flex flex-wrap gap-2",children:[(0,l.jsx)(d,{label:"Pendentes",value:"pendente",checked:a.status.includes("pendente"),onChange:()=>N("pendente"),color:"bg-yellow-100 text-yellow-800"}),(0,l.jsx)(d,{label:"Confirmados",value:"confirmado",checked:a.status.includes("confirmado"),onChange:()=>N("confirmado"),color:"bg-blue-100 text-blue-800"}),(0,l.jsx)(d,{label:"Em preparo",value:"em_preparo",checked:a.status.includes("em_preparo"),onChange:()=>N("em_preparo"),color:"bg-purple-100 text-purple-800"}),(0,l.jsx)(d,{label:"A caminho",value:"a_caminho",checked:a.status.includes("a_caminho"),onChange:()=>N("a_caminho"),color:"bg-indigo-100 text-indigo-800"}),(0,l.jsx)(d,{label:"Entregues",value:"entregue",checked:a.status.includes("entregue"),onChange:()=>N("entregue"),color:"bg-green-100 text-green-800"}),(0,l.jsx)(d,{label:"Cancelados",value:"cancelado",checked:a.status.includes("cancelado"),onChange:()=>N("cancelado"),color:"bg-red-100 text-red-800"})]})]})]}),(0,l.jsx)("div",{className:"mb-6",children:e?(0,l.jsx)("div",{className:"flex justify-center items-center h-40",children:(0,l.jsx)("div",{className:"animate-spin rounded-full h-10 w-10 border-t-2 border-b-2 border-primary"})}):(0,l.jsxs)(l.Fragment,{children:[(0,l.jsxs)("div",{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 gap-4 mb-6",children:[(0,l.jsx)(o,{title:"Total de Pedidos",value:u.totalOrders.toString(),icon:"\uD83D\uDCCA"}),(0,l.jsx)(o,{title:"Faturamento Total",value:(0,n.xG)(u.totalRevenue),icon:"\uD83D\uDCB0"}),(0,l.jsx)(o,{title:"Ticket M\xe9dio",value:(0,n.xG)(u.avgOrderValue),icon:"\uD83E\uDDFE"}),(0,l.jsx)(o,{title:"Taxa de Conclus\xe3o",value:"".concat(u.totalOrders>0?Math.round(u.completedOrders/u.totalOrders*100):0,"%"),icon:"✅"})]}),(0,l.jsxs)("div",{className:"grid grid-cols-1 md:grid-cols-3 lg:grid-cols-6 gap-4 mb-6",children:[(0,l.jsx)(o,{title:"Pendentes",value:u.pendingOrders.toString(),icon:"⏳",colorClass:"bg-yellow-50"}),(0,l.jsx)(o,{title:"Confirmados",value:(u.totalOrders-u.pendingOrders-u.completedOrders-u.canceledOrders).toString(),icon:"\uD83D\uDC68‍\uD83C\uDF73",colorClass:"bg-blue-50"}),(0,l.jsx)(o,{title:"Entregues",value:u.completedOrders.toString(),icon:"\uD83D\uDE9A",colorClass:"bg-green-50"}),(0,l.jsx)(o,{title:"Cancelados",value:u.canceledOrders.toString(),icon:"❌",colorClass:"bg-red-50"}),(0,l.jsx)(o,{title:"PIX",value:"".concat(O("pix"),"%"),icon:"\uD83D\uDCB8",colorClass:"bg-blue-50"}),(0,l.jsx)(o,{title:"Cart\xe3o",value:"".concat(O("cartao"),"%"),icon:"\uD83D\uDCB3",colorClass:"bg-purple-50"})]}),(0,l.jsxs)("div",{className:"bg-white rounded-xl shadow-sm p-6 mb-6",children:[(0,l.jsxs)("div",{className:"flex justify-between items-center mb-4",children:[(0,l.jsx)("h2",{className:"text-lg font-medium",children:"Produtos Mais Vendidos"}),(0,l.jsxs)("span",{className:"text-sm bg-primary text-white px-2 py-1 rounded-md",children:[f(a.dateRange.startDate)," - ",f(a.dateRange.endDate)]})]}),0===g.length?(0,l.jsx)("div",{className:"py-8 text-center text-gray-500",children:"Nenhum produto encontrado para os filtros selecionados"}):(0,l.jsx)("div",{className:"overflow-x-auto",children:(0,l.jsxs)("table",{className:"w-full",children:[(0,l.jsx)("thead",{children:(0,l.jsxs)("tr",{className:"border-b",children:[(0,l.jsx)("th",{className:"text-left py-2 px-2",children:"Produto"}),(0,l.jsx)("th",{className:"text-center py-2 px-2",children:"Quantidade"}),(0,l.jsx)("th",{className:"text-right py-2 px-2",children:"Faturamento"})]})}),(0,l.jsx)("tbody",{children:g.map((e,t)=>(0,l.jsxs)("tr",{className:"border-b hover:bg-gray-50",children:[(0,l.jsx)("td",{className:"py-3 px-2",children:(0,l.jsxs)("div",{className:"flex items-center",children:[(0,l.jsx)("span",{className:"inline-flex justify-center items-center w-6 h-6 rounded-full mr-2 ".concat(t<3?"bg-primary text-white":"bg-gray-100 text-gray-500"),children:t+1}),(0,l.jsx)("span",{className:"font-medium",children:e.productName})]})}),(0,l.jsx)("td",{className:"text-center py-3 px-2",children:(0,l.jsx)("span",{className:"inline-block min-w-[30px] px-2 py-1 bg-gray-100 rounded-full text-sm",children:e.quantity})}),(0,l.jsx)("td",{className:"text-right py-3 px-2 font-semibold",children:(0,n.xG)(e.totalRevenue)})]},e.productId))})]})})]}),(0,l.jsxs)("div",{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 gap-4 mb-6",children:[(0,l.jsx)(c,{title:"M\xe9dia por Dia",value:(0,n.xG)(u.totalRevenue/(new Date(a.dateRange.endDate).getTime()-new Date(a.dateRange.startDate).getTime())/864e5||1),subtext:"nos dias filtrados",change:"+12%",changeDirection:"up"}),(0,l.jsx)(c,{title:"Pedidos por Dia",value:(u.totalOrders/(new Date(a.dateRange.endDate).getTime()-new Date(a.dateRange.startDate).getTime())/864e5||1).toFixed(1),subtext:"m\xe9dia di\xe1ria",change:"+5%",changeDirection:"up"}),(0,l.jsx)(c,{title:"Itens por Pedido",value:(g.reduce((e,t)=>e+t.quantity,0)/(u.totalOrders||1)).toFixed(1),subtext:"m\xe9dia de itens",change:"+3%",changeDirection:"up"}),(0,l.jsx)(c,{title:"Taxa de Cancelamento",value:"".concat(u.totalOrders>0?Math.round(u.canceledOrders/u.totalOrders*100):0,"%"),subtext:"dos pedidos",change:"-2%",changeDirection:"down"})]}),(0,l.jsx)("div",{className:"flex justify-end",children:(0,l.jsxs)("button",{onClick:()=>window.print(),className:"px-4 py-2 bg-primary text-white rounded-lg hover:bg-primary-dark transition-colors flex items-center",children:[(0,l.jsx)("svg",{xmlns:"http://www.w3.org/2000/svg",className:"h-5 w-5 mr-2",viewBox:"0 0 20 20",fill:"currentColor",children:(0,l.jsx)("path",{fillRule:"evenodd",d:"M6 2a2 2 0 00-2 2v12a2 2 0 002 2h8a2 2 0 002-2V7.414A2 2 0 0015.414 6L12 2.586A2 2 0 0010.586 2H6zm5 6a1 1 0 10-2 0v2H7a1 1 0 100 2h2v2a1 1 0 102 0v-2h2a1 1 0 100-2h-2V8z",clipRule:"evenodd"})}),"Exportar Relat\xf3rio"]})})]})})]})}function d(e){let{label:t,value:a,checked:r,onChange:s,color:n}=e;return(0,l.jsxs)("label",{className:"inline-flex items-center px-3 py-1 rounded-full text-sm font-medium ".concat(r?n:"bg-gray-100 text-gray-500"," cursor-pointer transition-colors"),children:[(0,l.jsx)("input",{type:"checkbox",checked:r,onChange:s,className:"sr-only"}),t]})}function o(e){let{title:t,value:a,icon:r,colorClass:s="bg-white"}=e;return(0,l.jsxs)("div",{className:"rounded-xl shadow-sm p-5 ".concat(s," border border-gray-200"),children:[(0,l.jsxs)("div",{className:"flex justify-between items-center mb-3",children:[(0,l.jsx)("h3",{className:"text-gray-600 text-sm font-medium",children:t}),(0,l.jsx)("span",{className:"text-2xl",children:r})]}),(0,l.jsx)("p",{className:"text-2xl font-bold",children:a})]})}function c(e){let{title:t,value:a,subtext:r,change:s,changeDirection:n}=e;return(0,l.jsxs)("div",{className:"bg-white rounded-xl shadow-sm p-5 border border-gray-200",children:[(0,l.jsx)("h3",{className:"text-gray-600 text-sm font-medium mb-1",children:t}),(0,l.jsxs)("div",{className:"flex items-baseline",children:[(0,l.jsx)("p",{className:"text-2xl font-bold mr-2",children:a}),(0,l.jsxs)("span",{className:"text-xs px-1.5 py-0.5 rounded-full ".concat("up"===n?"bg-green-100 text-green-800":"bg-red-100 text-red-800"),children:["up"===n?"↑":"↓"," ",s]})]}),(0,l.jsx)("p",{className:"text-xs text-gray-500 mt-1",children:r})]})}},7823:function(e,t,a){"use strict";a.d(t,{OQ:function(){return r}});var l=a(4756);let r=(0,l.eI)("https://tcbketwbrlawpbktasva.supabase.co","eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6InRjYmtldHdicmxhd3Bia3Rhc3ZhIiwicm9sZSI6ImFub24iLCJpYXQiOjE3NDc1ODMzOTUsImV4cCI6MjA2MzE1OTM5NX0.ZSsKVOAlZj9GdYkS0a5kD7w1qE63ag86KfXVo3hnXzA",{auth:{persistSession:!0,autoRefreshToken:!0},global:{headers:{}}})},345:function(e,t,a){"use strict";a.d(t,{Ix:function(){return i},WF:function(){return r},aF:function(){return n},xG:function(){return s}});var l=a(7823);let r="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAGQAAABkCAYAAABw4pVUAAAACXBIWXMAAAsTAAALEwEAmpwYAAAFHGlUWHRYTUw6Y29tLmFkb2JlLnhtcAAAAAAAPD94cGFja2V0IGJlZ2luPSLvu78iIGlkPSJXNU0wTXBDZWhpSHpyZVN6TlRjemtjOWQiPz4gPHg6eG1wbWV0YSB4bWxuczp4PSJhZG9iZTpuczptZXRhLyIgeDp4bXB0az0iQWRvYmUgWE1QIENvcmUgNi4wLWMwMDYgNzkuMTY0NzUzLCAyMDIxLzAyLzE1LTExOjUyOjEzICAgICAgICAiPiA8cmRmOlJERiB4bWxuczpyZGY9Imh0dHA6Ly93d3cudzMub3JnLzE5OTkvMDIvMjItcmRmLXN5bnRheC1ucyMiPiA8cmRmOkRlc2NyaXB0aW9uIHJkZjphYm91dD0iIiB4bWxuczp4bXA9Imh0dHA6Ly9ucy5hZG9iZS5jb20veGFwLzEuMC8iIHhtbG5zOmRjPSJodHRwOi8vcHVybC5vcmcvZGMvZWxlbWVudHMvMS4xLyIgeG1sbnM6cGhvdG9zaG9wPSJodHRwOi8vbnMuYWRvYmUuY29tL3Bob3Rvc2hvcC8xLjAvIiB4bWxuczp4bXBNTT0iaHR0cDovL25zLmFkb2JlLmNvbS94YXAvMS4wL21tLyIgeG1sbnM6c3RFdnQ9Imh0dHA6Ly9ucy5hZG9iZS5jb20veGFwLzEuMC9zVHlwZS9SZXNvdXJjZUV2ZW50IyIgeG1wOkNyZWF0b3JUb29sPSJBZG9iZSBQaG90b3Nob3AgMjIuMyAoTWFjaW50b3NoKSIgeG1wOkNyZWF0ZURhdGU9IjIwMjEtMDQtMTlUMTM6Mzc6MTQrMDE6MDAiIHhtcDpNb2RpZnlEYXRlPSIyMDIxLTA0LTE5VDEzOjM4OjQyKzAxOjAwIiB4bXA6TWV0YWRhdGFEYXRlPSIyMDIxLTA0LTE5VDEzOjM4OjQyKzAxOjAwIiBkYzpmb3JtYXQ9ImltYWdlL3BuZyIgcGhvdG9zaG9wOkNvbG9yTW9kZT0iMyIgcGhvdG9zaG9wOklDQ1Byb2ZpbGU9InNSR0IgSUVDNjE5NjYtMi4xIiB4bXBNTTpJbnN0YW5jZUlEPSJ4bXAuaWlkOmM5ZDZlODQxLWIyYjYtNGIxYS1hYjQ2LTBhNjU5ZGIxYmY5OSIgeG1wTU06RG9jdW1lbnRJRD0ieG1wLmRpZDpjOWQ2ZTg0MS1iMmI2LTRiMWEtYWI0Ni0wYTY1OWRiMWJmOTkiIHhtcE1NOk9yaWdpbmFsRG9jdW1lbnRJRD0ieG1wLmRpZDpjOWQ2ZTg0MS1iMmI2LTRiMWEtYWI0Ni0wYTY1OWRiMWJmOTkiPiA8eG1wTU06SGlzdG9yeT4gPHJkZjpTZXE+IDxyZGY6bGkgc3RFdnQ6YWN0aW9uPSJjcmVhdGVkIiBzdEV2dDppbnN0YW5jZUlEPSJ4bXAuaWlkOmM5ZDZlODQxLWIyYjYtNGIxYS1hYjQ2LTBhNjU5ZGIxYmY5OSIgc3RFdnQ6d2hlbj0iMjAyMS0wNC0xOVQxMzozNzoxNCswMTowMCIgc3RFdnQ6c29mdHdhcmVBZ2VudD0iQWRvYmUgUGhvdG9zaG9wIDIyLjMgKE1hY2ludG9zaCkiLz4gPC9yZGY6U2VxPiA8L3htcE1NOkhpc3Rvcnk+IDwvcmRmOkRlc2NyaXB0aW9uPiA8L3JkZjpSREY+IDwveDp4bXBtZXRhPiA8P3hwYWNrZXQgZW5kPSJyIj8+f+lkGAAAALRJREFUeJzt0cENwDAIADFE0/0H6yhkgHug57OzKmk7M9sB3LXeCeyZkDgmJI4JiWNC4piQOCYkjgmJY0LimJA4JiSOCYljQuKYkDgmJI4JiWNC4piQOCYkjgmJY0LimJA4JiSOCYljQuKYkDgmJI4JiWNC4piQOCYkjgmJY0LimJA4JiSOCYljQuKYkDgmJI4JiWNC4piQOCYkjgmJY0LimJA4JiSOCYljQuKYkDg/nxMKXAp7CKEAAAAASUVORK5CYII=";function s(e){return new Intl.NumberFormat("pt-BR",{style:"currency",currency:"BRL"}).format(e)}function n(e,t){return e.length<=t?e:e.slice(0,t)+"..."}async function i(e,t,a){try{let r="".concat(Date.now(),"_").concat(e.name.toLowerCase().normalize("NFD").replace(/[\u0300-\u036f]/g,"").replace(/[^\w\s-]/g,"").replace(/\s+/g,"-").replace(/--+/g,"-").trim()),s=a?"".concat(a,"/").concat(r):r,{data:n,error:i}=await l.OQ.storage.from(t).upload(s,e,{cacheControl:"3600",upsert:!1});if(i)throw i;let{data:d}=l.OQ.storage.from(t).getPublicUrl(s);return d.publicUrl}catch(e){return console.error("Erro ao fazer upload da imagem:",e),console.warn("Usando imagem placeholder como fallback"),r}}}},function(e){e.O(0,[36,971,472,744],function(){return e(e.s=9991)}),_N_E=e.O()}]);